[{"value":"LET property_id = (\n    FOR p in property\n    FILTER LEFT(p._key,6) == \"69123:\"\n    LET property_id_value = TO_NUMBER(SUBSTRING(p._key,6,3))\n    SORT property_id_value DESC\n    LIMIT 1\n    return TO_NUMBER(SUBSTRING(p._key,6,3))\n    )\n    \nLET new_property_id = property_id + 1\n\nLET data = [\n\n{\n  \"_key\": CONCAT(\"69123:\",new_property_id),\n  \"property_info\": {\n      \"advertise\": {\n        \"property_title\": \"3.5 bhk\",\n        \"type_of_deal\": \"rent\",\n        \"minimum_duration_of_stay\": 3,\n        \"available_from_date\": \"2019-01-09\",\n\t\t\"available_to_date\": \"2019-04-09\",\n\t\t\"sizeof_property\": 15\n      },\n      \"property_status\": \"available\",\n      \"property_address\": {\n        \"street_name\": \"Mariaprobst Strasse 3\",\n        \"flat_number\": \"1105\",\n        \"city\": \"Heidelberg\",\n        \"pincode\": \"69123\",\n\t\t\"latitude\": 35.1269874,\n\t\t\"longitude\":4534897523\n      },\n      \"amount\": {\n        \"base_price\": 400,\n        \"nebenkosten\": 150,\n        \"deposit_amount\": 700,\n        \"cost_per_square_meter\": 0\n      }      \n\t}\n}\n]\n\n\nFOR d IN data\n    INSERT d INTO property\n    \n    INSERT {\n    \"_from\":CONCAT(\"property/69123:\",new_property_id),\n    \"_to\":\"property/69123\",\n    \"relationship\":\"in\"\n    } INTO property_feature_mapping\n    \n    LET user_id = (\n        for r in notification\n        filter  r._to == \"property/69123\"\n        return r._from\n        )\n    \n    FOR u in user_id\n        INSERT {\n        \"_from\":\"property/69123\",\n        \"_to\":u,\n        \"notification_of\":CONCAT(\"property/69123:\",new_property_id)\n        }\n        INTO notification","parameter":{},"name":"1.1 Property Insert"},{"value":"LET data = [\r\n{\r\n  \"user\": {\r\n    \"user_info\": {\r\n      \"first_name\": \"andreas\",\r\n      \"last_name\": \"weidmann\"\r\n    },\r\n    \"contact\": {\r\n      \"email\": \"weidmann@fitcore.com\",\r\n      \"phone\": \"+49 179 45530777\",\r\n      \"address\": {\r\n        \"pin_code\": 69123,\r\n        \"city\": \"heidelberg\",\r\n        \"state\": \"baden-w√ºrttemberg\",\r\n        \"country\": \"germany\"\r\n      }\r\n    },\r\n    \"personal_details\": {\r\n      \"gender\": \"male\"\r\n    },\r\n    \"type_of_membership\": \"premium\"\r\n  }\r\n}\r\n]\r\n\r\n\r\nFOR d IN data\r\n    INSERT d INTO User","parameter":{},"name":"1.2 User Insert"},{"value":"for p in property\nfilter p._key == \"69123:1\"\nreturn p ","parameter":{},"name":"0.0 fetch a property"},{"value":"for p in property\r\nfilter p.advertise.property_title == \"3.5 bhk\" and p.advertise.type_of_deal == \"rent\"\r\nand p.amount.base_price <=550 and p.amount.base_price >=350\r\nand p.property_address.city == 'Heidelberg' \r\nand p.advertise.available_from_date >= \"2019-01-08\"\r\nand p.property_status == \"available\"\r\nSORT p.sort_priority.weight DESC\r\nreturn {key :  p._key, weight : p.sort_priority.weight}","parameter":{},"name":"2. retrieve "},{"value":"let no_of_user = FIRST(for u in User\r\n                        collect with count into cnt\r\n                        return cnt)\r\n\r\nfor p in property\r\nfilter CONTAINS(p._key,\"69123\")\r\n\r\nlet nos =  LENGTH(\r\n             for v in 1..1 inbound CONCAT(\"property/\",p._key)  shortlist \r\nreturn 1)\r\n\r\nlet nov = LENGTH(p.viewers_user_id)\r\n\r\n\r\nlet slot = p.sort_priority.slot*100\r\n\r\nlet inter = ((nos+nov)/no_of_user)*100\r\n\r\nupdate p with {\"sort_priority\":{\"weight\" : inter+slot }} into property\r\n\r\nlet w = inter+slot\r\nsort w DESC\r\n\r\nreturn { p : p._key , weight : w }","parameter":{},"name":"5.1 priority calculations dynamic"},{"value":"let pin = \"69123\"\r\nlet type = \"sell\"\r\nlet all_p = (for d in property\r\nfilter d.property_address.pincode == pin and d.advertise.type_of_deal == type\r\nreturn d.amount.base_price\r\n)\r\nreturn {Area : pin , \"Avg Price\" : AVG(all_p),\"Min price\" : MIN (all_p),\"Max Price\" : MAX(all_p)}","parameter":{},"name":"3.1 avg Price of area"},{"value":"for p in property\nfilter left(p._key , 6) == \"69123:\"\nlet nov = LENGTH(p.viewers_user_id)\n\nlet nos =  LENGTH(\n             for v in 1..1 inbound CONCAT(\"property/\",p._key)  shortlist\n\t\t\treturn 1)\nSORT nov desc\nSORT nos desc\t\t\t\n\t\t\t\n\t\t\t\nreturn {id : p._key, \"number of views\" :nov,\"number of shortlist\" : nos  }","parameter":{},"name":"6. Property in Demand"},{"value":"let user_id = FIRST(for u in User filter u.user_info.first_name == \"sanket\" return u._id)\nfor v,e,p IN 1..1 outbound user_id shortlist\nreturn e\n\n","parameter":{},"name":"7.1 Property shortlist by a user"},{"value":"let user_id = FIRST(for u in User filter u.user_info.first_name == \"paneesh\" return u._id)\n\nfor r in recommend\nfilter r._to == user_id AND CONTAINS (r.recommended_property,\"property/\")\nreturn r","parameter":{},"name":"4.1 get all properties recommended to a user"},{"value":"for r in recommend\nfilter  r.recommended_property == \"property/69123:8\"\nreturn r","parameter":{},"name":"4.2 get to who all the property is recommended"},{"value":"let to_show = (\r\nfor p in property\r\nfilter p.advertise.property_title == \"3.5 bhk\" and p.advertise.type_of_deal == \"rent\"\r\nand p.amount.base_price <=550 and p.amount.base_price >=350\r\nand p.property_address.city == 'Heidelberg' \r\nand p.advertise.available_from_date >= \"2019-01-08\"\r\nand p.property_status == \"available\"\r\nSORT p.sort_priority.weight DESC\r\nreturn p._key\r\n)\r\n\r\nfor t in to_show\r\n    for p in property_feature_mapping\r\n    filter p._to == \"property/69123\" and p._from == CONCAT(\"property/\",t)\r\n    return p","parameter":{},"name":"2.1 graph retrieval "},{"value":"for r in notification\nfilter  r._to == \"property/69123\"\nreturn r","parameter":{},"name":"8.1 get all the user subscribed to get notified for a new property in 69123"},{"value":"for r in notification\nfilter  r.notification_of == \"property/69123:5\"\nreturn r","parameter":{},"name":"8.2 get all the users who were notified when 69123:5 was listed"},{"value":"for p in property\n    filter p._key == \"69123:2\"\n    for l in property\n        filter CONTAINS(l._key,'super_market')\n        let d = DISTANCE(p.coordinate[0], p.coordinate[1],l.coordinate[0], l.coordinate[1])\n        SORT d\n        limit 3\n        return {near_by : l._key ,\"Aerial distance(km)\" : d/1000}","parameter":{},"name":"9.1 search near by locations"},{"value":"\r\n\r\nFOR v,e IN OUTBOUND SHORTEST_PATH\r\n  \"property/69123:1\" TO \"property/bus_stop:1\"\r\n map\r\n return {from : e._from , to : e._to, distance : e.distance}","parameter":{},"name":"9.2 shortest path in number of hops"},{"value":"let user_id = FIRST(for u in User filter u.user_info.first_name == \"sanket\" return u._id)\r\n\r\nlet s_p = (for s in shortlist filter s._from == user_id return s._to)\r\n\r\nfor s in s_p\r\n    for p in property\r\n    filter p._key == REGEX_REPLACE(s,\"property/\", \"\")\r\n    return { key : p._key, Price : p.amount.base_price , size : p.advertise.property_title }","parameter":{},"name":"7.2 compare shortlisted properties"},{"value":"for p in property\nfilter p._key == '69123:3'\nlet h_data = p.stats.historical_prices\nfor d in h_data\nreturn  d","parameter":{},"name":"3.2 Historical Prices of property"},{"value":"for i in 2010..2019\r\nlet str_i = CONCAT(i,\"-12\")\r\n\r\nfor p in property\r\n    filter p.stats.historical_prices != null and p.property_address.city == \"Heidelberg\" \r\n\r\n    Collect d = FIRST(p.stats.historical_prices[* filter CURRENT.Date== str_i return CURRENT.Date]) aggregate\r\n    pr = AVG(FIRST(p.stats.historical_prices[* filter CURRENT.Date== str_i return CURRENT.Price])) into g\r\n    \r\n    filter d !=null and pr != null\r\n    sort d\r\nRETURN  {\r\n            Date : d,\r\n            Prices : pr\r\n        }\r\n\t\t","parameter":{},"name":"3.3 Historical Prices of region"}]